/* FINH Dashboard – mobile-first, cleaned
   - Keep FINH green palette
   - Remove duplicates / tighten sizes for 390×844 and up
   - Drop‑in replacement for /finh-theme.css
*/

/* =============== Base & tokens =============== */
*,*::before,*::after{box-sizing:border-box;min-width:0}
html,body{margin:0;padding:0;width:100%;overflow-x:hidden;background:linear-gradient(180deg,#4caf67 0%,#6dcf7b 45%,#b5e39f 100%) fixed;color:#11472d;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans Thai",Arial,sans-serif;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}
img,svg,canvas,video{max-width:100%;height:auto;display:block}

:root{
  /* colors */
  --finh-green-700:#0f5131;--finh-green-600:#16a34a;--finh-green-500:#22c55e;--finh-green-400:#34d399;
  --finh-blue-600:#2563eb;--finh-blue-500:#3b82f6;--finh-surface:#ffffff;--finh-slate-200:#e5e7eb;
  /* layout */
  --radius:16px;--shadow:0 1px 2px rgba(0,0,0,.07),0 6px 12px rgba(0,0,0,.04);
  --space-md:12px;--space-lg:16px;--bar-h:12px;
}

/* =============== Topbar =============== */
.topbar{position:sticky;top:0;z-index:50;display:grid; grid-template-columns: 1fr auto 1fr; align-items:center;gap:10px;padding:10px 12px;background:transparent;color:#fff; max-width:1400px; margin:0 auto; }
.topbar .left,.topbar .right{min-width:0;display:flex;align-items:center;gap:10px; justify-content: flex-end;}
.topbar .left{  justify-self:start; }
.topbar .brand{justify-self:center}
.topbar .right{ justify-self:end; justify-content:flex-end; }
.topbar .brand img{height:68px}
.avatar{width:38px;height:38px;border-radius:50%;object-fit:cover;box-shadow:0 0 0 2px rgba(255,255,255,.35)}
.user-meta b{display:block;font-weight:700;line-height:1}

#deviceSelect{appearance:none;border:1px solid #e5efe9;background:#fff;border-radius:999px;padding:6px 12px;font-weight:600;color:#0b3d23;box-shadow:0 2px 6px rgba(0,0,0,.06);max-width:46vw;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.icon-btn{width:34px;height:34px;border-radius:999px;display:inline-grid;place-items:center;background:#fff;border:1px solid #e5efe9;box-shadow:0 2px 6px rgba(0,0,0,.06);color:#0b3d23;cursor:pointer}

/* =============== Dashboard scaffold =============== */
.dashboard{padding:var(--space-lg) var(--space-md) 40px;max-width:1400px;margin:0 auto}
.dash-hero{border-radius:18px;padding:16px;background:linear-gradient(135deg,var(--finh-green-600),#19764a);color:#fff;display:grid;gap:10px}
.dash-hero h1{margin:0 0 4px;font-size:28px;line-height:1.15}
.dash-level{font-size:14px}

/* progress */
.progress-lite{display:flex;align-items:center;gap:8px}
.track{position:relative;flex:1;height:var(--bar-h);background:linear-gradient(180deg,rgba(255,255,255,.55),rgba(255,255,255,.35));border:1px solid rgba(255,255,255,.55);border-radius:999px;overflow:hidden;box-shadow:inset 0 2px 6px rgba(16,24,40,.12),0 4px 18px rgba(16,185,129,.20)}
.fill{position:relative;height:100%;width:0%;background:linear-gradient(90deg,#34d399 0%,#22c55e 40%,#16a34a 80%,#15803d 100%);border-radius:999px;transition:width .45s ease}
.pct{color:#0b3d23;background:#ffffffcc;backdrop-filter:blur(4px);font-weight:900;border-radius:999px;padding:4px 8px;min-width:48px;text-align:center;box-shadow:0 4px 16px rgba(0,0,0,.12),inset 0 0 0 1px rgba(255,255,255,.8)}

/* KPIs */
.dash-kpis{display:flex;flex-direction:column;gap:14px;margin:16px 0 12px}
.dkpi{display:grid;grid-template-columns:18px auto max-content;align-items:center;column-gap:8px}
.dkpi .kpi-ic{width:18px;height:18px;display:block;filter:drop-shadow(0 1px 1px rgba(0,0,0,.25));opacity:.95;color:#ffd639}
.dkpi small{opacity:.95}
.dkpi b{font-size:18px;margin:0;color:#fff}

/* Panels */
.dash-panels{display:grid;grid-template-columns:1fr;gap:12px; padding-top: 16px}
.dash-card{background:#fff;border:1px solid var(--finh-slate-200);border-radius:14px;padding:12px;box-shadow:var(--shadow)}
.dash-card h3{margin:0 0 8px;font-size:16px;}

/* Growth */
.dash-card.growth{background:#063417;border-color:#063417;color:#e9f6ee}
.dash-card.growth h3{color:#cfe9d7}
.dash-card.growth .dash-spark{height:170px;border-radius:12px;background:#063417}
.dash-spark canvas{width:100%;height:170px;display:block}

/* Alerts */
.dash-card.alerts{background:#ffd639;color:#000}
.dash-alerts{list-style:none;margin:0;padding:0;display:flex;flex-direction:column}
.dash-alerts li{display:flex;align-items:center;gap:10px;padding:12px;border-bottom:1px solid rgba(0,0,0,.18)}
.dash-alerts li:last-child{border-bottom:0}
.dash-alerts .ok,.dash-alerts .warn,.dash-alerts .bad{width:10px;height:10px;border-radius:50%}
.dash-alerts .ok{background:#16a34a}.dash-alerts .warn{background:#f59e0b}.dash-alerts .bad{background:#ef4444}

/* Controls */
.dash-card.controls{background:#0f2d22;color:#e9f6ee;border-color:#0f2d22}
.controls-head{display:flex;justify-content:space-between;align-items:baseline}
.controls-grid{display:grid;grid-template-columns:1fr;gap:12px;margin-top:8px}
.ctrl{position:relative;display:flex;justify-content:space-between;align-items:center;gap:12px;background:#123427;border:1px solid #184936;border-radius:12px;padding:12px}
.ctrl-meta b{color:#eaf8f0}
.ctrl input{position:absolute;opacity:0;pointer-events:none}
.ctrl .switch{width:56px;height:30px;border-radius:999px;background:#2a5041;border:1px solid #1f3f32;position:relative;transition:.2s}
.ctrl .switch::after{content:"";position:absolute;top:50%;left:4px;transform:translateY(-50%);width:22px;height:22px;border-radius:50%;background:#e2fbe8;box-shadow:0 2px 6px rgba(0,0,0,.35);transition:left .2s ease}
.ctrl input:checked + .switch{background:#16a34a;border-color:#15803d}
.ctrl input:checked + .switch::after{left:30px;background:#fff}
.ctrl-hint{margin-top:8px;font-size:12px;color:#bfe9cc}

/* Harvests */
.table-wrap{overflow:auto;margin-top:8px}
.tbl{width:100%;border-collapse:separate;border-spacing:0}
.tbl th,.tbl td{padding:10px 12px;border-bottom:1px solid rgba(0,0,0,.08);text-align:left}
.tbl th{font-weight:700}
.tbl td.num,.tbl th.num{text-align:right}
.harv-head{display:flex;flex-direction:column;gap:8px}
.harv-toolbar{display:flex;flex-wrap:wrap;gap:8px;justify-content:space-between;align-items:center}
.harv-toolbar .filters{display:flex;flex-wrap:wrap;gap:8px}
.harv-toolbar input[type="date"],.harv-toolbar select,.harv-toolbar .search{border:1px solid var(--finh-slate-200);border-radius:10px;padding:6px 10px;background:#fff}
.harv-summary{display:flex;gap:8px;flex-wrap:wrap}
.harv-summary .chip{display:flex;gap:6px;align-items:baseline;background:#f3faf6;border:1px solid #e6f3ea;border-radius:999px;padding:6px 10px;font-size:12px}
.qc{display:inline-block;padding:2px 8px;border-radius:999px;font-size:12px;font-weight:700;border:1px solid transparent}
.qc-pass{color:#065f46;background:#d1fae5;border-color:#a7f3d0}
.qc-fail{color:#7f1d1d;background:#fee2e2;border-color:#fecaca}
.qc-none{color:#374151;background:#f3f4f6;border-color:#e5e7eb}
.qc-other{color:#1f2937;background:#e0e7ff;border-color:#c7d2fe}
.table-wrap .empty{padding:14px;text-align:center;color:#4b5563;border:1px dashed #d1d5db;border-radius:10px;margin-top:8px}
.table-wrap .loading{display:flex;align-items:center;gap:8px;padding:12px;color:#0b3d23;font-weight:700}
.loading .dot{width:6px;height:6px;background:#16a34a;border-radius:50%;display:inline-block;animation:bump 1s infinite ease-in-out}
.loading .dot:nth-child(2){animation-delay:.15s}.loading .dot:nth-child(3){animation-delay:.3s}
@keyframes bump{0%,80%,100%{transform:scale(0)}40%{transform:scale(1)}}

/* =============== Responsive =============== */
@media (min-width:820px){
  .topbar .brand img{height:88px}
  .dashboard{padding:18px 16px 40px}
  .dash-hero{padding:24px;border-radius:20px}
  .dash-hero h1{font-size:42px}
  :root{--bar-h:14px}
  .pct{min-width:56px}
  .dash-kpis{flex-direction:row;gap:24px}
  .dkpi{grid-template-columns:22px auto}
  .dkpi b{grid-column:1/-1;font-size:26px;line-height:1;margin-top:8px}
  .dash-panels{grid-template-columns:2fr 1.2fr 1.8fr;gap:16px}
  .dash-card.growth .dash-spark,.dash-spark canvas{height:220px}
  .avatar{width:55px;height:55px}
}
